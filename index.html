<!DOCTYPE html>
<html>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
<body>

<style>
.form-control:focus {
  box-shadow: none;
}

.form-control-underlined {
  border-width: 0;
  border-bottom-width: 1px;
  border-radius: 0;
  padding-left: 0;
}
</style>

<div class="container mt-5">
  <div class="row justify-content-center">
      <div class="col-md-6">
        <div class="position-relative">
          <div id="chooseHeader">

          </div>
          <!-- <img src="AskJerry_cropped.png" class="img-fluid mb-4" alt="Responsive image"> -->
          <div class="input-group mb-4">
              <input class="form-control" type="text" id="searchbox" aria-label="Search" placeholder="Search Berkeley Architecture Research documentation...">
              <button class="btn btn-primary" type="button " onclick="doQuery()">Ask Now</button>
          </div>
          <!-- <form>
            <div class="row mb-4">
              <div class="form-group col-md-9">
                <input id="searchbox" type="search" placeholder="What're you searching for?" class="form-control form-control-underlined" aria-label="Search">
              </div>
              <div class="form-group col-md-3">
                <button type="button" class="btn btn-danger rounded-pill btn-block shadow-sm" onclick="doQuery()">Search</button>
              </div>
            </div>
          </form> -->
        </div>
<div id="dropdowns" class="container mt-3">

</div>
<!-- <button onclick="doQuery()">Search</button> -->
</div>

<!-- <p id="demo"></p> -->

<script>

//choose header image
//get url
var url = window.location.href;
// if it is ask jerry
console.log(url);
if (url.includes("askjerry")) {
  document.getElementById("chooseHeader").innerHTML = '<img src="AskJerry_cropped.png" class="img-fluid mb-4" alt="Responsive image">';
} else {
  document.getElementById("chooseHeader").innerHTML = '<img src="https://bar.eecs.berkeley.edu/images/logo.png" class="img-fluid mt-5 mb-5" alt="Responsive image">';
}
// TODO: add GH-issues, add mailing lists
var projects = [
  [
    "Chipyard Docs",
    "chipyard.readthedocs.io",
    ["latest", "stable", "1.10.0", "1.9.1", "1.9.0", "1.8.1", "1.8.0", "1.7.1", "1.7.0", "1.6.2", "1.6.1", "1.6.0", "1.5.0", "1.4.0", "1.3.0", "1.2.0", "1.1.0", "1.0.0", "main"]
  ],
  [
    "FireSim Docs",
    "docs.fires.im",
    ["latest", "stable", "1.17.1", "1.17.0", "1.16.0", "1.15.2", "1.15.1", "1.15.0", "1.14.2", "1.14.1", "1.14.0", "1.13.6", "1.13.5", "1.13.4", "1.13.3", "1.13.2", "1.13.1", "1.13.0", "1.12.0", "1.11.0", "1.10.1", "1.10.0", "1.9.0", "1.8.0", "1.7.0", "1.6.0", "1.5.0", "1.4.0", "1.3.2", "1.3.1", "1.3.0", "1.2", "1.1", "main"]
  ],
  [
    "FireMarshal Docs",
    "firemarshal.readthedocs.io",
    ["latest", "stable", "v1.12.1", "v1.12.0", "v1.11.0", "v1.10.0"]
  ],
  [
    "BOOM Docs",
    "docs.boom-core.org",
    ["latest", "stable"]
  ],
  [
    "Hammer Docs",
    "hammer-vlsi.readthedocs.io",
    ["latest", "stable", "1.2.0", "1.1.2", "1.1.1", "1.1.0", "1.0.4", "1.0.1", "1.0.0", "0.1.0"]
  ]
];

var misc_sites = [
  [ "Chipyard Issues", "https://github.com/ucb-bar/chipyard/issues" ],
  [ "FireSim Issues", "https://github.com/firesim/firesim/issues" ],
  [ "FireMarshal Issues", "https://github.com/firesim/FireMarshal/issues" ],
  [ "BOOM Issues", "https://github.com/riscv-boom/riscv-boom/issues" ],
  [ "Hammer Issues", "https://github.com/ucb-bar/hammer/issues" ],
  [ "Chipyard Mailing List", "https://groups.google.com/forum/#!forum/chipyard" ],
  [ "FireSim Mailing List", "https://groups.google.com/forum/#!forum/firesim" ],
  [ "BOOM Mailing List", "https://groups.google.com/forum/#!forum/riscv-boom" ]
]

for (var i = 0; i < projects.length; i++) {
    var drop_name = projects[i][0];
    var dropdownContents = '<div class="input-group mb-3">'; // Bootstrap input group

    // Bootstrap label for the dropdown
    dropdownContents += '<div class="input-group-prepend">';
    drop_name2 = "'" + drop_name + "'";
    dropdownContents += '<label class="btn btn-outline-secondary" onclick="changecheckboxes('+drop_name2+')" for="' + drop_name + ' id=' + drop_name + '"> <input type="checkbox" autocomplete="off" Checked id="' + drop_name + 'checkbox"> ' + drop_name + '</label>';
    dropdownContents += '</div>';

    // Bootstrap styled select dropdown
    dropdownContents += '<select class="custom-select" name="' + drop_name + '" id="' + drop_name + 'dropdown">';

    for (var j = 0; j < projects[i][2].length; j++) {
        var temp_val = projects[i][2][j];
        dropdownContents += '<option value="' + temp_val + '">' + temp_val + '</option>';
    }

    dropdownContents += '</select>';
    dropdownContents += '</div>'; // Close input group

    document.getElementById("dropdowns").innerHTML += dropdownContents;
}

for (var i = 0; i < misc_sites.length; i++) {
    var drop_name = misc_sites[i][0];
    var dropdownContents = '<div class="input-group mb-3">'; // Bootstrap input group

    // Bootstrap label for the dropdown
    dropdownContents += '<div class="input-group-prepend">';
    drop_name2 = "'" + drop_name + "'";
    dropdownContents += '<label class="btn btn-outline-secondary" onclick="changecheckboxes('+drop_name2+')" for="' + drop_name + ' id=' + drop_name + '"> <input type="checkbox" autocomplete="off" Checked id="' + drop_name + 'checkbox"> ' + drop_name + '</label>';
    dropdownContents += '</div>';

    dropdownContents += '</div>'; // Close input group

    document.getElementById("dropdowns").innerHTML += dropdownContents;
}

function formSite(s) {
  return "site:" + s;
}

function doQuery() {
  var querystring = document.getElementById("searchbox").value + " (";

  var sites_to_search = [];

  for (var i = 0; i < projects.length; i++) {
    enabled = document.getElementById(projects[i][0] + "checkbox").checked;
    if (!enabled) {
      continue;
    }
    version_num = document.getElementById(projects[i][0] + "dropdown").value;
    url_part = projects[i][1];
    sites_to_search.push(formSite(url_part + "/en/" + version_num));
  }

  for (var i = 0; i < misc_sites.length; i++) {
    enabled = document.getElementById(misc_sites[i][0] + "checkbox").checked;
    if (!enabled) {
      continue;
    }
    sites_to_search.push(formSite(misc_sites[i][1]));
  }

  for (var i = 0; i < sites_to_search.length; i++) {
    querystring += sites_to_search[i];

    if (i != sites_to_search.length-1) {
      querystring += " OR ";
    }
  }

  // SPACE IS IMPORTANT
  querystring += " )"

  var googlequery = "https://www.google.com/search?q=";
  googlequery += encodeURIComponent(querystring);

  window.location.href = googlequery;
}

var wage = document.getElementById("searchbox");
wage.addEventListener("keydown", function (e) {
  if (e.code === "Enter") {  //checks whether the pressed key is "Enter"
    doQuery();
  }
});

function changecheckboxes(name) {
  //get the id of the button that was clicked on
  // var id = this.id;
  // console.log(id);
  //get the checkbox that is associated with this button
  var checkbox = document.getElementById(name + "checkbox");
  //toggle the checkbox
  checkbox.checked = !checkbox.checked;
  // console.log(checkbox.checked);
}

</script>

</body>
</html>
